<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Fake DAQ for NEESgrid: fake_daq.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>fake_daq.c File Reference</h1>A fake DAQ program for testing NSDS et al.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;sys/types.h&gt;</code><br>
<code>#include &lt;sys/socket.h&gt;</code><br>
<code>#include &lt;netinet/in.h&gt;</code><br>
<code>#include &lt;arpa/inet.h&gt;</code><br>
<code>#include &lt;netdb.h&gt;</code><br>
<code>#include &lt;assert.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;math.h&gt;</code><br>
<code>#include &lt;unistd.h&gt;</code><br>
<code>#include &lt;stdint.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;signal.h&gt;</code><br>
<code>#include &lt;time.h&gt;</code><br>
<code>#include &lt;pthread.h&gt;</code><br>
<code>#include &lt;getopt.h&gt;</code><br>
<code>#include "nsds_util.h"</code><br>
<code>#include "flog.h"</code><br>

<p>
<a href="fake__daq_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="structconnection__fds.html">connection_fds</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">hold a copy of the network file descriptors so that the signal handler can stop the program  <a href="structconnection__fds.html#_details">More...</a><br><br></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="fake__daq_8c.html#a11">data_active_count</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return number of active channels.  <a href="#a11"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>bool&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="fake__daq_8c.html#a12">data_channel_enabled</a> (const int channel_id)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Is a channel subscribed?  <a href="#a12"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="fake__daq_8c.html#a13">data_channel_flag</a> (const int channel_id, const bool subscribe)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Mark a channel as subscribed or unsubscribed.  <a href="#a13"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>double&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="fake__daq_8c.html#a14">data_generate</a> (const int index, const double sin_period)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Data generator. Sine wave of sorts.  <a href="#a14"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="fake__daq_8c.html#a15">sighandler</a> (int signal)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Control-break handler. Sets global flag to indicate exit request.  <a href="#a15"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="fake__daq_8c.html#a16">data_thread_main</a> (void *arg)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Data handling thread.  <a href="#a16"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="fake__daq_8c.html#a17">daq_do_work</a> (const int control_socket, const int data_socket)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Main worker routine: read / parse / respond.  <a href="#a17"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="fake__daq_8c.html#a18">daq_main_loop</a> (const int daq_port)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Open network socket, loop doing work until control-c.  <a href="#a18"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="fake__daq_8c.html#a19">main</a> (int argc, char *argv[])</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Init the network, talk to all.  <a href="#a19"></a><br><br></td></tr>
<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>const int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="fake__daq_8c.html#a0">DAQ_PORT</a> = 55055</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Default TCP port to listen on.  <a href="#a0"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>const int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="fake__daq_8c.html#a1">TCP_Q_LEN</a> = 1</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">TCP queue length, number of queued connections allowed.  <a href="#a1"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>bool&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="fake__daq_8c.html#a2">control_break</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Global boolean set by signal handler to force exit.  <a href="#a2"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>float&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="fake__daq_8c.html#a3">sample_rate</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Fake data sample rate.  <a href="#a3"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>bool&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="fake__daq_8c.html#a4">streaming_active</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Global boolean for IPC between threads.  <a href="#a4"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>const int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="fake__daq_8c.html#a5">SINE_PERIOD</a> = 80*NUM_CHANNELS</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Length (period) of the sine wave we generate.  <a href="#a5"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap>struct {</td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;pthread_mutex_t&nbsp;&nbsp;&nbsp;<b>mutex</b></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;bool&nbsp;&nbsp;&nbsp;<a class="el" href="fake__daq_8c.html#a7">active</a> [NUM_CHANNELS]</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">R/W mutex for struct.  <a href="#o1"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;int&nbsp;&nbsp;&nbsp;<b>num_active</b></td></tr>

<tr><td class="memItemLeft" nowrap valign=top>}&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="fake__daq_8c.html#a9">chan_struct</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Shared structure for subscribed data channels.  <a href="#a9"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="structconnection__fds.html">connection_fds</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="fake__daq_8c.html#a10">curr_connection</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Global, hold file descriptors for signal handler to close.  <a href="#a10"></a><br><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
A fake DAQ program for testing NSDS et al. 
<p>
<dl compact><dt><b>Note:</b></dt><dd>Requires the flog messaging library.</dd></dl>
This has gotten a bit more useful. Currently streams NUM_CHANNELS fake data channels of sinusoidal data at 20Hz with a period of 100 samples. Threaded, with data on the second thread. If you replace the data_generate routine, this would make a decent skeleton DAQ program. Data rate is selectable on the command line.<p>
Robust against most network failures - knows to restart, etc. Simple signal handler a la the driver as well.<p>
Note that this uses integer channel IDs, where LabVIEW often has multicharacter descriptive strings like "RoomTempCelsius". That makes this code much much simpler, and for this application simplicity wins. For more useful testing, you should get labview and its fake DAQ (or real!) code working anyway.<p>
If you're using this as skeleton code for another DAQ system, be aware than you can name a DAQ channel as any printable ASCII string. It does complicate the parsing of open-port and close-port requests, though.<p>
<dl compact><dt><b>Date:</b></dt><dd>9/5/02 </dd></dl>
<dl compact><dt><b>Author:</b></dt><dd>Paul Hubbard</dd></dl>

<p>
Definition in file <a class="el" href="fake__daq_8c-source.html">fake_daq.c</a>.<hr><h2>Function Documentation</h2>
<a class="anchor" name="a17" doxytag="fake_daq.c::daq_do_work" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int daq_do_work           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const int&nbsp;</td>
          <td class="mdname" nowrap> <em>control_socket</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>const int&nbsp;</td>
          <td class="mdname" nowrap> <em>data_socket</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Main worker routine: read / parse / respond. 
<p>
<dl compact><dt><b>Date:</b></dt><dd>9/5/02</dd></dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>0</em>&nbsp;</td><td>OK, != 0 means error </td></tr>
  </table>
</dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>control_socket</em>&nbsp;</td><td>FD of control connection </td></tr>
    <tr><td></td><td valign=top><em>data_socket</em>&nbsp;</td><td>FD of data connection Read commands, respond as required. Starts data thread if necessary. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="fake__daq_8c-source.html#l00464">464</a> of file <a class="el" href="fake__daq_8c-source.html">fake_daq.c</a>.
<p>
References <a class="el" href="fake__daq_8c-source.html#l00097">data_active_count()</a>, <a class="el" href="fake__daq_8c-source.html#l00180">data_channel_flag()</a>, <a class="el" href="fake__daq_8c-source.html#l00317">data_thread_main()</a>, and <a class="el" href="fake__daq_8c-source.html#l00066">streaming_active</a>.
<p>
Referenced by <a class="el" href="fake__daq_8c-source.html#l00757">daq_main_loop()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="fake_daq.c::daq_main_loop" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void daq_main_loop           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>daq_port</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Open network socket, loop doing work until control-c. 
<p>
<dl compact><dt><b>Date:</b></dt><dd>9/5/02 </dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>Opens server socket</dd></dl>
This handles the dropped connections and other TCP errors, mostly by restarting the connects. Also kills data thread if connections die. 
<p>
Definition at line <a class="el" href="fake__daq_8c-source.html#l00757">757</a> of file <a class="el" href="fake__daq_8c-source.html">fake_daq.c</a>.
<p>
References <a class="el" href="fake__daq_8c-source.html#l00060">control_break</a>, <a class="el" href="fake__daq_8c-source.html#l00083">connection_fds::control_socket</a>, <a class="el" href="fake__daq_8c-source.html#l00089">curr_connection</a>, <a class="el" href="fake__daq_8c-source.html#l00464">daq_do_work()</a>, <a class="el" href="fake__daq_8c-source.html#l00085">connection_fds::data_socket</a>, <a class="el" href="fake__daq_8c-source.html#l00066">streaming_active</a>, and <a class="el" href="fake__daq_8c-source.html#l00057">TCP_Q_LEN</a>.
<p>
Referenced by <a class="el" href="fake__daq_8c-source.html#l00848">main()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="fake_daq.c::data_active_count" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int data_active_count           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Return number of active channels. 
<p>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>Number</em>&nbsp;</td><td>active, &lt;0 if error </td></tr>
  </table>
</dl>
<dl compact><dt><b>Date:</b></dt><dd>9/27/02 </dd></dl>

<p>
Definition at line <a class="el" href="fake__daq_8c-source.html#l00097">97</a> of file <a class="el" href="fake__daq_8c-source.html">fake_daq.c</a>.
<p>
References <a class="el" href="fake__daq_8c.html#a9">chan_struct</a>.
<p>
Referenced by <a class="el" href="fake__daq_8c-source.html#l00464">daq_do_work()</a>, and <a class="el" href="fake__daq_8c-source.html#l00317">data_thread_main()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="fake_daq.c::data_channel_enabled" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> bool data_channel_enabled           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>channel_id</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Is a channel subscribed? 
<p>
Locks mutex and checks array to see if a channel is subscribed.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>channel_id</em>&nbsp;</td><td>Channel ID to check </td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>True</em>&nbsp;</td><td>or false, false if error </td></tr>
  </table>
</dl>
<dl compact><dt><b>Note:</b></dt><dd>uses mutex lock on chan_struct </dd></dl>
<dl compact><dt><b>Date:</b></dt><dd>9/24/02 </dd></dl>

<p>
Definition at line <a class="el" href="fake__daq_8c-source.html#l00134">134</a> of file <a class="el" href="fake__daq_8c-source.html">fake_daq.c</a>.
<p>
References <a class="el" href="fake__daq_8c.html#a9">chan_struct</a>.
<p>
Referenced by <a class="el" href="fake__daq_8c-source.html#l00317">data_thread_main()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="fake_daq.c::data_channel_flag" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int data_channel_flag           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const int&nbsp;</td>
          <td class="mdname" nowrap> <em>channel_id</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>const bool&nbsp;</td>
          <td class="mdname" nowrap> <em>subscribe</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Mark a channel as subscribed or unsubscribed. 
<p>
Lock the mutex, set the bit, report if it changed.<p>
<dl compact><dt><b>Note:</b></dt><dd>Idempotent - call multiple times w/no harm done. </dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>channel_id</em>&nbsp;</td><td>Channel ID in question </td></tr>
    <tr><td></td><td valign=top><em>subscribe</em>&nbsp;</td><td>if true, subscribe, if false un-sub </td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>0</em>&nbsp;</td><td>if OK, non-zero if error </td></tr>
  </table>
</dl>
<dl compact><dt><b>Note:</b></dt><dd>Uses chan_struct and mutex therein </dd></dl>
<dl compact><dt><b>Date:</b></dt><dd>9/24/02 </dd></dl>

<p>
Definition at line <a class="el" href="fake__daq_8c-source.html#l00180">180</a> of file <a class="el" href="fake__daq_8c-source.html">fake_daq.c</a>.
<p>
References <a class="el" href="fake__daq_8c.html#a9">chan_struct</a>.
<p>
Referenced by <a class="el" href="fake__daq_8c-source.html#l00464">daq_do_work()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="fake_daq.c::data_generate" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> double data_generate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const int&nbsp;</td>
          <td class="mdname" nowrap> <em>index</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>const double&nbsp;</td>
          <td class="mdname" nowrap> <em>sin_period</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Data generator. Sine wave of sorts. 
<p>
<dl compact><dt><b>Date:</b></dt><dd>9/16/02 </dd></dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>sin(x),scaled</em>&nbsp;</td><td>to period </td></tr>
  </table>
</dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>index</em>&nbsp;</td><td>0 to N-1 </td></tr>
    <tr><td></td><td valign=top><em>sin_period</em>&nbsp;</td><td>Period of function, cannot be zero! </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="fake__daq_8c-source.html#l00263">263</a> of file <a class="el" href="fake__daq_8c-source.html">fake_daq.c</a>.
<p>
Referenced by <a class="el" href="fake__daq_8c-source.html#l00317">data_thread_main()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="fake_daq.c::data_thread_main" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void* data_thread_main           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>arg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Data handling thread. 
<p>
Transient thread to send data out the data channel. Dead simple. Generates data and sends it out the data socket.<p>
<dl compact><dt><b>Note:</b></dt><dd>Assumes NSDS will read at least as fast as the DAQ sends!</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>arg</em>&nbsp;</td><td>Ptr to file descriptor to use for socket </td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>Null</em>&nbsp;</td><td>always </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="fake__daq_8c-source.html#l00317">317</a> of file <a class="el" href="fake__daq_8c-source.html">fake_daq.c</a>.
<p>
References <a class="el" href="fake__daq_8c-source.html#l00060">control_break</a>, <a class="el" href="fake__daq_8c-source.html#l00097">data_active_count()</a>, <a class="el" href="fake__daq_8c-source.html#l00134">data_channel_enabled()</a>, <a class="el" href="fake__daq_8c-source.html#l00263">data_generate()</a>, <a class="el" href="fake__daq_8c-source.html#l00063">sample_rate</a>, <a class="el" href="fake__daq_8c-source.html#l00069">SINE_PERIOD</a>, and <a class="el" href="fake__daq_8c-source.html#l00066">streaming_active</a>.
<p>
Referenced by <a class="el" href="fake__daq_8c-source.html#l00464">daq_do_work()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="fake_daq.c::main" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int main           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em>[]</td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Init the network, talk to all. 
<p>
Sets up messaging, installs signal handler, calls worker routine.<p>
<dl compact><dt><b>Note:</b></dt><dd>Driver port passed on command line <p>
Ditto w/sample rate </dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>argc</em>&nbsp;</td><td>Argc as passed by shell </td></tr>
    <tr><td></td><td valign=top><em>argv</em>&nbsp;</td><td>Argv as passed by shell </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>0 All is good <p>
Non-zero All is not good </dd></dl>

<p>
Definition at line <a class="el" href="fake__daq_8c-source.html#l00848">848</a> of file <a class="el" href="fake__daq_8c-source.html">fake_daq.c</a>.
<p>
References <a class="el" href="fake__daq_8c.html#a9">chan_struct</a>, <a class="el" href="fake__daq_8c-source.html#l00060">control_break</a>, <a class="el" href="fake__daq_8c-source.html#l00757">daq_main_loop()</a>, <a class="el" href="fake__daq_8c-source.html#l00054">DAQ_PORT</a>, <a class="el" href="fake__daq_8c-source.html#l00063">sample_rate</a>, and <a class="el" href="fake__daq_8c-source.html#l00288">sighandler()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="fake_daq.c::sighandler" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void sighandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>signal</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Control-break handler. Sets global flag to indicate exit request. 
<p>
<dl compact><dt><b>Note:</b></dt><dd>Assumes installed in interrupt chain by someone else </dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>signal</em>&nbsp;</td><td>Signal number </td></tr>
  </table>
</dl>
<dl compact><dt><b>Date:</b></dt><dd>3/25/02 </dd></dl>

<p>
Definition at line <a class="el" href="fake__daq_8c-source.html#l00288">288</a> of file <a class="el" href="fake__daq_8c-source.html">fake_daq.c</a>.
<p>
References <a class="el" href="fake__daq_8c-source.html#l00060">control_break</a>, <a class="el" href="fake__daq_8c-source.html#l00083">connection_fds::control_socket</a>, <a class="el" href="fake__daq_8c-source.html#l00089">curr_connection</a>, and <a class="el" href="fake__daq_8c-source.html#l00085">connection_fds::data_socket</a>.
<p>
Referenced by <a class="el" href="fake__daq_8c-source.html#l00848">main()</a>.    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a7" doxytag="fake_daq.c::active" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> bool <a class="el" href="fake__daq_8c.html#a7">active</a>[NUM_CHANNELS]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
R/W mutex for struct. 
<p>

<p>
Definition at line <a class="el" href="fake__daq_8c-source.html#l00075">75</a> of file <a class="el" href="fake__daq_8c-source.html">fake_daq.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="fake_daq.c::chan_struct" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> struct { ... }   <a class="el" href="fake__daq_8c.html#a9">chan_struct</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Shared structure for subscribed data channels. 
<p>

<p>
Referenced by <a class="el" href="fake__daq_8c-source.html#l00097">data_active_count()</a>, <a class="el" href="fake__daq_8c-source.html#l00134">data_channel_enabled()</a>, <a class="el" href="fake__daq_8c-source.html#l00180">data_channel_flag()</a>, and <a class="el" href="fake__daq_8c-source.html#l00848">main()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="fake_daq.c::control_break" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> bool <a class="el" href="fake__daq_8c.html#a2">control_break</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Global boolean set by signal handler to force exit. 
<p>

<p>
Definition at line <a class="el" href="fake__daq_8c-source.html#l00060">60</a> of file <a class="el" href="fake__daq_8c-source.html">fake_daq.c</a>.
<p>
Referenced by <a class="el" href="fake__daq_8c-source.html#l00757">daq_main_loop()</a>, <a class="el" href="fake__daq_8c-source.html#l00317">data_thread_main()</a>, <a class="el" href="fake__daq_8c-source.html#l00848">main()</a>, and <a class="el" href="fake__daq_8c-source.html#l00288">sighandler()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="fake_daq.c::curr_connection" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="structconnection__fds.html">connection_fds</a> <a class="el" href="fake__daq_8c.html#a10">curr_connection</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Global, hold file descriptors for signal handler to close. 
<p>

<p>
Definition at line <a class="el" href="fake__daq_8c-source.html#l00089">89</a> of file <a class="el" href="fake__daq_8c-source.html">fake_daq.c</a>.
<p>
Referenced by <a class="el" href="fake__daq_8c-source.html#l00757">daq_main_loop()</a>, and <a class="el" href="fake__daq_8c-source.html#l00288">sighandler()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="fake_daq.c::DAQ_PORT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> const int <a class="el" href="fake__daq_8c.html#a0">DAQ_PORT</a> = 55055          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Default TCP port to listen on. 
<p>

<p>
Definition at line <a class="el" href="fake__daq_8c-source.html#l00054">54</a> of file <a class="el" href="fake__daq_8c-source.html">fake_daq.c</a>.
<p>
Referenced by <a class="el" href="fake__daq_8c-source.html#l00848">main()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="fake_daq.c::sample_rate" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> float <a class="el" href="fake__daq_8c.html#a3">sample_rate</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Fake data sample rate. 
<p>

<p>
Definition at line <a class="el" href="fake__daq_8c-source.html#l00063">63</a> of file <a class="el" href="fake__daq_8c-source.html">fake_daq.c</a>.
<p>
Referenced by <a class="el" href="fake__daq_8c-source.html#l00317">data_thread_main()</a>, and <a class="el" href="fake__daq_8c-source.html#l00848">main()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="fake_daq.c::SINE_PERIOD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> const int <a class="el" href="fake__daq_8c.html#a5">SINE_PERIOD</a> = 80*NUM_CHANNELS          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Length (period) of the sine wave we generate. 
<p>

<p>
Definition at line <a class="el" href="fake__daq_8c-source.html#l00069">69</a> of file <a class="el" href="fake__daq_8c-source.html">fake_daq.c</a>.
<p>
Referenced by <a class="el" href="fake__daq_8c-source.html#l00317">data_thread_main()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="fake_daq.c::streaming_active" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> bool <a class="el" href="fake__daq_8c.html#a4">streaming_active</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Global boolean for IPC between threads. 
<p>

<p>
Definition at line <a class="el" href="fake__daq_8c-source.html#l00066">66</a> of file <a class="el" href="fake__daq_8c-source.html">fake_daq.c</a>.
<p>
Referenced by <a class="el" href="fake__daq_8c-source.html#l00464">daq_do_work()</a>, <a class="el" href="fake__daq_8c-source.html#l00757">daq_main_loop()</a>, and <a class="el" href="fake__daq_8c-source.html#l00317">data_thread_main()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="fake_daq.c::TCP_Q_LEN" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> const int <a class="el" href="fake__daq_8c.html#a1">TCP_Q_LEN</a> = 1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
TCP queue length, number of queued connections allowed. 
<p>

<p>
Definition at line <a class="el" href="fake__daq_8c-source.html#l00057">57</a> of file <a class="el" href="fake__daq_8c-source.html">fake_daq.c</a>.
<p>
Referenced by <a class="el" href="fake__daq_8c-source.html#l00757">daq_main_loop()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu Feb 24 13:34:30 2005 for Fake DAQ for NEESgrid by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
